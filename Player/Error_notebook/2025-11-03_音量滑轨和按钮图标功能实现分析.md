# éŸ³é‡æ»‘è½¨å’ŒæŒ‰é’®å›¾æ ‡åŠŸèƒ½å®ç°åˆ†æ

## é—®é¢˜å›é¡¾

### åŸå§‹é—®é¢˜
1. **éŸ³é‡æ»‘è½¨å¡é¡¿**ï¼šæ‹–æ‹½éŸ³é‡æ»‘å—æ—¶å‡ºç°å¡é¡¿ç°è±¡
2. **ä¸èƒ½è°ƒèŠ‚éŸ³é‡**ï¼šéŸ³é‡æ»‘å—æ— æ³•æ­£å¸¸è°ƒèŠ‚éŸ³é‡
3. **æ— æ³•è”åŠ¨é™éŸ³å›¾æ ‡**ï¼šéŸ³é‡å˜åŒ–æ—¶é™éŸ³æŒ‰é’®å›¾æ ‡ä¸æ›´æ–°

## è§£å†³æ–¹æ¡ˆåˆ†æ

### å½“å‰å®ç°çŠ¶æ€
ç»è¿‡ä¼˜åŒ–ï¼ŒéŸ³é‡æ»‘è½¨åŠŸèƒ½å·²ç»å®Œå…¨æ­£å¸¸ï¼Œå…·ä½“æ”¹è¿›åŒ…æ‹¬ï¼š

#### 1. éŸ³é‡å±æ€§ä¼˜åŒ– (BottomViewModel.cs)
```csharp
// éŸ³é‡å±æ€§ - æ”¯æŒåŒå‘ç»‘å®š
public int Volume
{
    get => _playbackState.Volume;
    set
    {
        if (_playbackState.Volume != value)
        {
            _playbackState.Volume = value;
            
            // é€šè¿‡æ¶ˆæ¯é€šçŸ¥å…¶ä»–æ¨¡å—ï¼ˆå¦‚ MiddleViewModelï¼‰éŸ³é‡å·²æ”¹å˜
            _messengerService.Send(new ChangeVolumeMessage(value));
            OnVolumeChangedMessage();
        }
    }
}
```

#### 2. éŸ³é‡å›¾æ ‡è”åŠ¨æœºåˆ¶
- **VolumeToIconConverter.cs**ï¼šå°†éŸ³é‡å€¼è½¬æ¢ä¸ºå¯¹åº”çš„å›¾æ ‡ç±»å‹
- **é™éŸ³çŠ¶æ€æ£€æµ‹**ï¼šç»“åˆ `IsMuted` å±æ€§å’ŒéŸ³é‡å€¼åˆ¤æ–­å›¾æ ‡çŠ¶æ€
- **å¤šçº§éŸ³é‡å›¾æ ‡**ï¼šæ ¹æ®éŸ³é‡å¤§å°æ˜¾ç¤ºä¸åŒå›¾æ ‡ï¼ˆé™éŸ³ã€ä½ã€ä¸­ã€é«˜ï¼‰

#### 3. æ¶ˆæ¯é€šä¿¡æœºåˆ¶
- **ChangeVolumeMessage**ï¼šéŸ³é‡å˜æ›´æ¶ˆæ¯
- **ToggleMuteMessage**ï¼šé™éŸ³åˆ‡æ¢æ¶ˆæ¯
- **PlaybackStateChangedMessage**ï¼šæ’­æ”¾çŠ¶æ€å˜æ›´æ¶ˆæ¯

## å®ç°æ–¹æ¡ˆåæ€ä¸ä¼˜åŒ–

### âš ï¸ æ˜“é”™ç‚¹åˆ†æ

**å…³é”®å‘ç°ï¼š** åœ¨åŒå‘ç»‘å®šä¸”æœ‰å”¯ä¸€å¯ä¿¡æºçš„æƒ…å†µä¸‹ï¼ŒéŸ³é‡/è¿›åº¦è°ƒèŠ‚åŠŸèƒ½ä¸éœ€è¦å¤æ‚çš„å‘½ä»¤æœºåˆ¶ã€‚

**å¸¸è§é”™è¯¯æ¨¡å¼ï¼š**
1. **è¿‡åº¦è®¾è®¡**ï¼šä¸ºç®€å•åŒå‘ç»‘å®šåˆ›å»ºå¤æ‚çš„äº‹ä»¶å‘½ä»¤æœºåˆ¶
2. **å¿½ç•¥MVVMæœ¬è´¨**ï¼šåŒå‘ç»‘å®šæœ¬èº«å°±æ˜¯MVVMçš„æ ¸å¿ƒæœºåˆ¶
3. **é‡å¤é€»è¾‘**ï¼šåœ¨å±æ€§setterä¸­é‡å¤æ‰§è¡Œå‘½ä»¤é€»è¾‘

### ğŸ”§ ä¼˜åŒ–åçš„å®ç°åŸåˆ™

1. **ç®€åŒ–æ˜¯é‡‘**ï¼šå¯¹äºçº¯ç²¹çš„æ•°å€¼å±æ€§æ›´æ–°ï¼Œç›´æ¥ä½¿ç”¨åŒå‘ç»‘å®š
2. **ä¿¡ä»»ç»‘å®šæœºåˆ¶**ï¼šWPFçš„åŒå‘ç»‘å®šè¶³å¤Ÿå¤„ç†å¤§éƒ¨åˆ†ç”¨æˆ·äº¤äº’åœºæ™¯
3. **å•ä¸€èŒè´£**ï¼šå±æ€§setteråªè´Ÿè´£å€¼è½¬æ¢ï¼Œå‘½ä»¤å¤„ç†ç”±ä¸“é—¨çš„å‘½ä»¤æ–¹æ³•å®Œæˆ

### è¿›åº¦æ¡åŠŸèƒ½é‡æ„

åŸºäºä¸Šè¿°åŸåˆ™ï¼Œè¿›åº¦æ¡åŠŸèƒ½å·²é‡æ–°è®¾è®¡ï¼š

#### âœ… é‡æ„åçš„Progresså±æ€§
```csharp
public double Progress
{
    get => _playbackState.TotalDuration > 0 ?
        (_playbackState.PlaybackTime / (double)_playbackState.TotalDuration) * 100 : 0;
    set
    {
        // ç”¨æˆ·æ‹–æ‹½æ—¶ä¸æ‰§è¡Œè·³è½¬ï¼Œé¿å…å¹²æ‰°
        if (!_isUserDragging)
        {
            // å°†ç™¾åˆ†æ¯”è½¬æ¢ä¸ºæ—¶é—´å¹¶å‘é€è·³è½¬æ¶ˆæ¯
            if (_playbackState.TotalDuration > 0)
            {
                var targetTimeMs = (long)(_playbackState.TotalDuration * value / 100);
                var targetTime = TimeSpan.FromMilliseconds(targetTimeMs);
                _messengerService.Send(new SeekMessage(targetTime));
            }
        }
    }
}
```

#### âœ… ä¼˜åŒ–çš„æ‹–æ‹½äº‹ä»¶å¤„ç†
- ä½¿ç”¨`PreviewMouseLeftButtonDown/Up`å’Œ`LostMouseCapture`äº‹ä»¶
- é€šè¿‡`EventTrigger`å’Œ`InvokeCommandAction`ç»‘å®šå‘½ä»¤
- æ‹–æ‹½çŠ¶æ€ç®¡ç†é¿å…æ­»å¾ªç¯

#### âœ… ç®€åŒ–çš„è¿›åº¦æ›´æ–°é€»è¾‘
```csharp
private void OnProgressUpdatedMessage(object recipient, ProgressUpdatedMessage message)
{
    // å…³é”®ï¼šæ‹–æ‹½æ—¶ä¸æ›´æ–°è¿›åº¦ï¼Œé¿å…æ­»å¾ªç¯å’Œå¹²æ‰°ç”¨æˆ·æ“ä½œ
    if (!_isUserDragging)
    {
        // ç›´æ¥é€šçŸ¥UIæ›´æ–°è¿›åº¦æ˜¾ç¤ºï¼Œä¸éœ€è¦ä¿®æ”¹PlaybackTime
        OnPropertyChanged(nameof(Progress));
        UpdateTimeDisplay();
    }
}
```

## æŠ€æœ¯å®ç°è¦ç‚¹

### MVVMæ¨¡å¼åº”ç”¨
1. **æ•°æ®ç»‘å®š**ï¼šéŸ³é‡/è¿›åº¦æ»‘å—ä½¿ç”¨ `TwoWay` ç»‘å®šæ¨¡å¼
2. **å‘½ä»¤æ¨¡å¼**ï¼šé€šè¿‡ `RelayCommand` å¤„ç†ç”¨æˆ·äº¤äº’
3. **æ¶ˆæ¯é€šä¿¡**ï¼šä½¿ç”¨ `IMessengerService` å®ç°æ¨¡å—é—´é€šä¿¡

### éŸ³é‡å›¾æ ‡è½¬æ¢é€»è¾‘
```csharp
private void UpdateVolumeIcon(int volume)
{
    if (IsMuted || volume == 0)
    {
        VolumeIcon = "VolumeOff";
    }
    else if (volume < 33)
    {
        VolumeIcon = "VolumeLow";
    }
    else if (volume < 66)
    {
        VolumeIcon = "VolumeMedium";
    }
    else
    {
        VolumeIcon = "VolumeHigh";
    }
}
```

## å½“å‰åŠŸèƒ½çŠ¶æ€

### âœ… å·²è§£å†³çš„é—®é¢˜
1. **éŸ³é‡æ»‘è½¨å¡é¡¿**ï¼šé€šè¿‡ä¼˜åŒ–ç»‘å®šæœºåˆ¶è§£å†³
2. **éŸ³é‡è°ƒèŠ‚åŠŸèƒ½**ï¼šåŒå‘ç»‘å®šæ­£å¸¸å·¥ä½œ
3. **é™éŸ³å›¾æ ‡è”åŠ¨**ï¼šéŸ³é‡å˜åŒ–æ—¶å›¾æ ‡è‡ªåŠ¨æ›´æ–°
4. **é™éŸ³åŠŸèƒ½**ï¼šé™éŸ³æŒ‰é’®æ­£å¸¸å·¥ä½œ

### âœ… é‡æ„åçš„è¿›åº¦æ¡åŠŸèƒ½
1. **æµç•…çš„è¿›åº¦è°ƒèŠ‚**ï¼šåŸºäºçº¯åŒå‘ç»‘å®šå®ç°
2. **æ— æ­»å¾ªç¯**ï¼šæ‹–æ‹½çŠ¶æ€ç®¡ç†é¿å…æ­»å¾ªç¯
3. **å“åº”è¿…é€Ÿ**ï¼šç®€åŒ–çš„äº‹ä»¶å¤„ç†æœºåˆ¶

## ä»£ç æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
- **BottomViewModel.cs**ï¼šåº•éƒ¨æ§åˆ¶æ è§†å›¾æ¨¡å‹ï¼Œå¤„ç†éŸ³é‡å’Œè¿›åº¦é€»è¾‘
- **VolumeToIconConverter.cs**ï¼šéŸ³é‡å€¼åˆ°å›¾æ ‡è½¬æ¢å™¨
- **BottomControl.xaml**ï¼šéŸ³é‡æ»‘è½¨å’Œè¿›åº¦æ¡çš„UIå®šä¹‰

### ç›¸å…³æ¶ˆæ¯ç±»å‹
- **ChangeVolumeMessage**ï¼šéŸ³é‡å˜æ›´æ¶ˆæ¯
- **ToggleMuteMessage**ï¼šé™éŸ³åˆ‡æ¢æ¶ˆæ¯
- **ProgressUpdatedMessage**ï¼šè¿›åº¦æ›´æ–°æ¶ˆæ¯
- **SeekMessage**ï¼šè·³è½¬æ¶ˆæ¯

## æ€»ç»“

**é‡æ„åçš„ä¼˜åŠ¿ï¼š**
1. **ä»£ç ç®€æ´**ï¼šç§»é™¤äº†ä¸å¿…è¦çš„å¤æ‚å‘½ä»¤æœºåˆ¶
2. **æ€§èƒ½æå‡**ï¼šå‡å°‘äº†ä¸­é—´ç¯èŠ‚ï¼Œå“åº”æ›´ç›´æ¥
3. **ç»´æŠ¤æ€§**ï¼šé€»è¾‘æ›´æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
4. **ç¬¦åˆMVVMè§„èŒƒ**ï¼šçœŸæ­£éµå¾ªäº†"ç»‘å®šä¼˜å…ˆï¼Œå‘½ä»¤è¡¥å……"çš„åŸåˆ™

**æ ¸å¿ƒç»éªŒï¼š** 
- åœ¨WPF MVVMå¼€å‘ä¸­ï¼Œè¦ä¿¡ä»»å’Œå–„ç”¨åŒå‘ç»‘å®šæœºåˆ¶
- é¿å…ä¸ºç®€å•ä»»åŠ¡åˆ›å»ºå¤æ‚çš„å‘½ä»¤æ¶æ„
- åŒå‘ç»‘å®šåœ¨æœ‰å”¯ä¸€å¯ä¿¡æºçš„æƒ…å†µä¸‹æ˜¯æœ€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆ
- ç®€åŒ–æ˜¯ä»£ç è´¨é‡çš„é‡è¦ä¿è¯

è¯¥è§£å†³æ–¹æ¡ˆé‡‡ç”¨äº†æ ‡å‡†çš„WPF MVVMæ¨¡å¼ï¼Œé€šè¿‡æ¶ˆæ¯é€šä¿¡æœºåˆ¶å®ç°äº†æ¨¡å—é—´çš„è§£è€¦ï¼Œç¡®ä¿äº†åŠŸèƒ½çš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚