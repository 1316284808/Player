<UserControl x:Class="Player.Bottom.BottomControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
            
             xmlns:coreHelpers="clr-namespace:Player.Core.Helpers;assembly=Player.Core"
             xmlns:localHelpers="clr-namespace:Player.Helpers"
             xmlns:local="clr-namespace:Player.Bottom"
             xmlns:viewModels="clr-namespace:Player.ViewModels"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
          
             d:DataContext="{d:DesignInstance Type=viewModels:BottomViewModel, IsDesignTimeCreatable=False}"
             mc:Ignorable="d"
             FontFamily="Segoe UI" Cursor="">

    <UserControl.Resources>

        <!-- 播放速度转换器 -->
        <localHelpers:SpeedConverter x:Key="SpeedConverter" />
        <!-- 音量图标转换器 -->
        <local:VolumeToIconConverter x:Key="VolumeToIconConverter" />
        <!-- 播放/暂停图标转换器 -->
        <local:BoolToPlayPauseIconConverter x:Key="PlayPauseIconConverter" />
        <!-- 全屏图标转换器 -->
        <local:BoolToFullscreenIconConverter x:Key="FullscreenIconConverter" />
    </UserControl.Resources>

    <!-- 播放器控制栏容器 -->
    <Border x:Name="PlayerControlsContainer" 
            Style="{StaticResource PlayerControlsContainer}"
            MouseEnter="PlayerControlsContainer_MouseEnter"
            MouseLeave="PlayerControlsContainer_MouseLeave">
        <Border.RenderTransform>
            <TransformGroup>
                <ScaleTransform/>
                <SkewTransform/>
                <RotateTransform/>
                <TranslateTransform/>
            </TransformGroup>
        </Border.RenderTransform>
        <Border.Triggers>
            <EventTrigger RoutedEvent="Border.Loaded">
                <BeginStoryboard>
                    <Storyboard>
                        <DoubleAnimation 
                            Storyboard.TargetProperty="Opacity" 
                            From="0" To="1" 
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
            <!-- 添加透明度变化触发器，实现平滑过渡 -->
            <EventTrigger RoutedEvent="Border.MouseEnter">
                <BeginStoryboard>
                    <Storyboard>
                        <DoubleAnimation 
                            Storyboard.TargetProperty="Opacity" 
                            To="1" 
                            Duration="0:0:0.3">
                            <DoubleAnimation.EasingFunction>
                                <CubicEase EasingMode="EaseOut"/>
                            </DoubleAnimation.EasingFunction>
                        </DoubleAnimation>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Border.Triggers>
        <Border.Resources>
            <!-- 全屏样式触发器 -->
            <Style TargetType="Border" x:Key="FullscreenControlStyle">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding PlaybackState.IsFullscreen}" Value="True">
                        <Setter Property="Background" Value="#80000000"/>
                        <Setter Property="CornerRadius" Value="0"/>
                        <Setter Property="Padding" Value="20,10"/>
                        <Setter Property="Height" Value="60"/>
                        <Setter Property="VerticalAlignment" Value="Bottom"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Border.Resources>
        
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="auto"/>
            </Grid.RowDefinitions>
            <!-- 控制按钮区域 -->
            <Grid Grid.Row="0" VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="0.25*" MinWidth="60"/>
                    <ColumnDefinition Width="*" MinWidth="200"/>
                    <ColumnDefinition Width="auto" MinWidth="80"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- 播放/暂停按钮 -->
                <Button Grid.Column="0" 
                        x:Name="PlayPauseButton" 
                        ToolTip="播放/暂停"
                        Command="{Binding TogglePlayPauseCommand}"
                        Style="{StaticResource SpecialShapePlayButton}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Margin="0,0,8,0">
                    <coreHelpers:CustomIcon Kind="{Binding IsPlaying, Converter={StaticResource PlayPauseIconConverter}}"  Foreground="White"  />
                </Button>

                <!-- 静音按钮 -->
                <Button Grid.Column="1" 
                        x:Name="MuteButton" 
                        ToolTip="静音"
                        Command="{Binding ToggleMuteCommand}"
                        Style="{StaticResource CircularIconButton}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                    <coreHelpers:CustomIcon Kind="{Binding Volume, Converter={StaticResource VolumeToIconConverter}}" 
                                      Foreground="{DynamicResource PrimaryBrush}" 
                                      Width="18" 
                                      Height="18"/>
                </Button>

                <!-- 音量滑块（使用 Behaviors 绑定拖拽事件） -->
                <Slider Grid.Column="2" 
                        x:Name="VolumeSlider" 
                        Minimum="0" 
                        Maximum="100" 
                        Value="{Binding Volume, Mode=TwoWay}" 
                        Orientation="Horizontal" 
                        ToolTip="音量调节"
                        Style="{StaticResource PlayerSlider}"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Center"
                        Margin="15,0" 
                        Cursor="Hand">

                </Slider>

                <!-- 播放进度条 -->
                <Slider Grid.Column="3" 
                        x:Name="ProgressBar" 
                        Minimum="0" 
                        Maximum="100" 
                        Value="{Binding DragProgress, Mode=TwoWay}"  
                        Orientation="Horizontal"
                        Style="{StaticResource PlayerSlider}"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Center"
                        Margin="10,0" 
                        ToolTip="播放进度">
                    <Slider.Resources>
                        <Style TargetType="Thumb">
                            <Setter Property="Cursor" Value="Hand"/>
                        </Style>
                    </Slider.Resources>
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
                            <i:InvokeCommandAction Command="{Binding BeginDragProgressCommand}"/>
                        </i:EventTrigger>
                        <i:EventTrigger EventName="PreviewMouseLeftButtonUp">
                            <i:InvokeCommandAction Command="{Binding EndDragProgressCommand}" 
                                                   CommandParameter="{Binding DragProgress}"/>
                        </i:EventTrigger>
                    </i:Interaction.Triggers>
                </Slider>

                <!-- 时间显示 -->
                <TextBlock Grid.Column="4" 
                          x:Name="TimeDisplay" 
                          Text="{Binding TimeDisplay}" 
                          Style="{StaticResource TimeDisplayStyle}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          ToolTip="播放时间"/>

                <!-- 播放倍速下拉列表 -->
                <ComboBox Grid.Column="5" 
                          x:Name="SpeedComboBox" 
                          ToolTip="播放速度"
                          Style="{StaticResource CompactComboBox}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Center"
                          Margin="8,0,8,0"
                          SelectedIndex="{Binding SelectedSpeedIndex, Mode=TwoWay}"
                          Cursor="Hand">
                    <ComboBoxItem Content="0.5"/>
                    <ComboBoxItem Content="1.0"/>
                    <ComboBoxItem Content="1.5"/>
                    <ComboBoxItem Content="2.0"/>
                </ComboBox>

                <!-- 全屏按钮 -->
                <Button Grid.Column="6" 
                        x:Name="FullscreenButton" 
                        ToolTip="{Binding IsFullscreen, Converter={StaticResource FullscreenIconConverter}}"
                        Command="{Binding ToggleFullscreenCommand }"
                        Style="{StaticResource CircularIconButton}"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                    <coreHelpers:CustomIcon Kind="{Binding IsFullscreen, Converter={StaticResource FullscreenIconConverter}}" 
                                      Foreground="{DynamicResource PrimaryBrush}" 
                                      Width="20" 
                                      Height="20"/>
                </Button>

            </Grid>
        </Grid>
    </Border>
</UserControl>